# Какие-то заметки про Linux, Fedora, NeoVim и.т.д

Здесь я буду собирать информацию о проблемах и о решениях

## 2024-04-04. Проблемы с Fedora после обновлений, откат

Я искренне люблю Fedora, но после последнего обновления (`sudo dnf upgrade --refresh`),
не только у меня, наблюдаются косяки с выключением / перезагрузкой, ноутбук тупо зависает
и приходится нажимать Power.

Походу придётся переключиться на старое ядро.
Вроде после обнов поломалось, в том числе обнова ядра была.

```bash
sudo grubby --info=ALL
sudo grubby --default-index
sudo grubby --set-default-index=1
```
Первая команда покажет список ядер,
Fedora (по умолчанию) держит 3 последних ядра, чтоб в случае чего откатиться.

Вторая команда выведет индекс юзаемого ядра.

А третья команда используется, чтобы выставить индекс ядра.
0 = последнее, 1 = предпоследнее и.т.д. Т.е предпоследнее в данном случае.
После выполнения команд нужно сделать reboot само собой.

## 2024-04-14. LSP, Mason, lockfile exists, OmniSharp

Столкнулся на второй машине со странной ошибкой установки Language-сервера OmniSharp(C#)
для NeoVim через Mason. Написало что-то типа "lockfile exists", и типа не может поставить,
уже ставится. Перезапуск не помогал. Нашёл в `~/.local/share/nvim/mason/staging` файл
`omnisharp.lock`, удалил, всё поставилось.

## 2024-05-25. NeoVim 0.10, Treesitter Lua, Fedora

Прилетели наконец обновы, NeoVim 0.10, ну думаю поставлю.
Поставил, теперь думай как исправлять конфиг. Зачем они так делают.

Так самый абсурд в том, что открывая файлы C# / JS проблем нет,
вообще никаких ошибок, а когда открываю свой же конфиг на Lua, ошибки.

Забавно, после выполнения в NeoVim команды `:TSInstall lua` походу ошибок никаких нет.
Над просто было прописать в конфиге чтоб TreeSitter для нужных языков ставился
в `ensure_installed`. Т.е нужно было установить TreeSitter для Lua.

В чате написали, что это проблема мейнтейнеров, которые не совсем правильно
опакетили NeoVim под Fedora, потому что они должны были включить Lua TreeSitter
как зависимость... В любом случае проблема решается.

## 2024-07-27. PostgreSQL. Peer authentication failed

>connection to server on socket "/var/run/postgresql/.s.PGSQL.5432" failed: FATAL:
Peer authentication failed for user "Какое-тоИмяПользователя"

Ситуация. Заходим в `psql` и для существующей базы пишем `\c БазаДанных Пользователь`.
Пользователь существует, база данных существует, но выскакивает ошибка, текст её выше.
Также ошибка проявляется при подключении к базе из кода.

Сначала нужно найти файл `pg_hba.conf`.
Для этого нужно в `psql` выполнить `SHOW hba_file;`.
В моём случае результат `/var/lib/pgsql/data/pg_hba.conf`.

Дальше открыть этот файл, возможно `sudo` понадобится.
Как-то вот так, `sudo nvim /var/lib/pgsql/data/pg_hba.conf`.
И дальше, по информации отсюда

https://www.postgresql.org/docs/current/auth-pg-hba-conf.html

https://hassanannajjar.medium.com/how-to-fix-error-password-authentication-failed-for-the-user-in-postgresql-896e1fd880dc

https://stackoverflow.com/questions/18664074/getting-error-peer-authentication-failed-for-user-postgres-when-trying-to-ge

нужно заменить в каких-то местах `peer` на `password` или `trust`.
Я заменил вот в этой строке `peer` на `trust`:

`local   all             all                                     trust`

А в строках ниже `indent` / `peer` заменил на `md5`.
В конце нужно выполнить команду `sudo systemctl restart postgresql`,
чтоб изменения сразу же вступили в силу, без перезагрузки. Вероятно это
какое-то не очень нормальное решение, но для разработки очень даже подойдёт.
Потому что к базе данных можно будет подключиться наконец.

## 2024-08-08. Изменение URL для Git-репозитория

Стандартная ситуация, репозиторий переехал по другому адресу,
в моём случае это изменение юзернейма на GitHub.

Выполняем команду
```bash
git remote set-url origin НовыйАдрес
```

Вместо `origin` может быть что угодно.
